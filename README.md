# Verbalize Yourself

Verbalize Yourself is an AI-assisted operations workspace that converts free-form shift notes into structured tasks, analytics, and competency insights. An Angular 20 single-page application collaborates with a FastAPI backend so teams can analyse feedback, triage tickets, and oversee automation quotas from one control plane.

## Highlights
- **Task operations hub** 窶・Drag cards across custom board columns, apply quick filters for overdue or unassigned work, and manage subtasks, comments, and activity history from a unified drawer backed by the workspace signal store.
- **AI-guided intake** 窶・Submit raw notes for analysis and receive JSON-schema validated card proposals generated by the OpenAI Responses API. The frontend filters suggestions and lets operators publish them directly into the workspace store.
- **Status reporting** 窶・Compose shift reports, run on-demand AI analysis, and convert generated proposals into linked cards while maintaining a full audit trail of submissions, failures, and approvals.
- **Analytics & continuous improvement** 窶・Administrators review feedback recurrence, root-cause trees, initiatives, and suggested actions. Dashboards surface key metrics and allow proposal-to-card conversions without leaving the analytics view.
- **Governance & competency management** 窶・The admin console controls API credentials, daily quotas, error categories, competencies, and evaluation jobs. Profile pages display AI-authored competency feedback, quota usage, and history to each member.

## Technology Stack
- **Frontend** 窶・Angular standalone components with signal-based state management, Angular CDK drag-and-drop, Tailwind utility styling, and ESLint/Prettier formatting.
- **Backend** 窶・FastAPI with SQLAlchemy ORM models, modular routers, service layer orchestration, and startup migrations that keep SQLite or PostgreSQL schemas aligned automatically.
- **AI Integration** 窶・`ChatGPTClient` wraps the OpenAI Responses API, validates responses against strict JSON schemas, and powers status report analysis, proposal generation, and Japanese-language appeal narratives.

## Repository Layout
```
.
笏懌楳笏 backend/                # FastAPI application, routers, services, and models
笏懌楳笏 frontend/               # Angular SPA with feature-based routing
笏懌楳笏 docs/                   # Architecture notes, feature specs, and known issues
笏懌楳笏 prompts/                # Prompt engineering references for AI interactions
笏懌楳笏 scripts/                # Utility scripts (e.g. conflict resolution helpers)
笏披楳笏 start-localhost.bat     # Windows helper that installs deps and launches both apps
```

## Getting Started
### Prerequisites
- Python 3.11+ with `pip` for the backend runtime and tooling.
- Node.js 20+ and npm for Angular CLI scripts.
- SQLite (bundled) or a PostgreSQL database URL for persistent storage.
- An OpenAI API key managed through the admin settings UI so AI-assisted flows can reach the Responses API.
- Optionally set `SECRET_ENCRYPTION_KEY` to encrypt stored API credentials instead of using the default fallback.

### Environment Variables
Create a `.env` file in the repository root or export variables before launching the backend. Common settings include:

| Variable | Description | Default |
| --- | --- | --- |
| `DATABASE_URL` | SQLAlchemy connection string. Use PostgreSQL for production workloads. | `sqlite:///./todo.db` |
| `DEBUG` | Enables verbose logging and exception responses. | `False` |
| `CHATGPT_MODEL` | OpenAI model name used by the ChatGPT client. | `gpt-4o-mini` |
| `SECRET_ENCRYPTION_KEY` | AES key for encrypting stored secrets. | `verbalize-yourself` |
| `ALLOWED_ORIGINS` | Comma-separated list of CORS origins for the SPA. | `http://localhost:4200` |

### Configure AI credentials & admin access
1. Launch the backend and frontend (see the steps below).
2. Register the first account through the SPA 窶・the backend automatically promotes the first user to an administrator.
3. Open **Admin 竊・API & Quotas** and store your OpenAI API key. Secrets are encrypted using `SECRET_ENCRYPTION_KEY` before they are persisted.
4. Optional: adjust daily quotas or grant additional administrators from **Admin 竊・Users**.

### One-click startup on Windows
Run the bundled script from the repository root. It creates a virtual environment, installs Python and npm dependencies, and launches both servers in separate terminals.

```
start-localhost.bat
```

The backend starts on <http://localhost:8000> (with auto-applied migrations and `/docs` for Swagger) and the Angular dev server runs on <http://localhost:4200>.

### Manual startup (macOS/Linux)
1. **Backend**
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r backend/requirements.txt
   # Optional tooling
   pip install -r backend/requirements-dev.txt
   uvicorn app.main:app --reload --app-dir backend
   ```
   Startup migrations run automatically and create the SQLite database or upgrade your configured database schema. Update `backend/app/database.py` if you need to customise engine parameters such as connection pooling.

2. **Frontend** (new terminal)
   ```bash
   cd frontend
   npm install
   npm start
   ```
   The Angular dev server provides hot module replacement at <http://localhost:4200>. Adjust the backend origin, if necessary, in `frontend/src/app/core/api/api.config.ts`.

### Configuring the API base URL for production deployments

The frontend automatically targets the backend origin when it is served from a non-localhost domain. If your deployment proxies the FastAPI server through a different host or path, expose the base URL via a meta tag in `index.html`:

```html
<meta name="verbalize:api-base-url" content="https://api.example.com" />
```

When no override is provided and the app is accessed from localhost, the SPA falls back to `http://localhost:8000` so the development servers continue to work out of the box.

### Running Tests & Quality Checks
Execute the relevant checks before opening a pull request. Use the focused commands when you only touched documentation.

```bash
# Backend
pytest backend/tests
ruff check backend
black --check backend/app backend/tests

# Frontend
cd frontend
npm test -- --watch=false --runInBand --testEnvironment=jsdom
npm run lint
npm run format:check
npm run build
```

The backend suite uses pytest and httpx, while the frontend relies on the Angular CLI (Karma/Jasmine) plus ESLint, Prettier, and the production build step.

## Additional Documentation
- `docs/architecture.md` 窶・System architecture, routing, and key flows.
- `docs/development-rules.md` 窶・Workflow expectations and required quality checks.
- `docs/features/` 窶・Feature-level requirements and detailed designs.
- `docs/known-issues.md` 窶・Outstanding UI and UX issues tracked for follow-up.

Consult these documents before implementing changes so specifications, workflow rules, and implementation details remain aligned.


<div class="flex min-h-screen flex-col bg-surface">
  <header class="shell-header">
    <div
      class="shell-header__content mx-auto flex max-w-7xl flex-col gap-6 px-6 py-8 lg:flex-row lg:items-center lg:justify-between"
    >
      <div class="flex w-full flex-col gap-6 lg:flex-row lg:items-center lg:gap-12">
        <div class="flex items-center gap-4">
          <span
            class="flex h-12 w-12 items-center justify-center rounded-2xl bg-gradient-to-br from-accent to-accent-strong text-lg font-semibold text-on-surface-inverse shadow-strong"
          >
            TG
          </span>
          <div>
            <p class="text-xs uppercase tracking-[0.35em] text-slate-400 dark:text-slate-500">
              Todo Generator
            </p>
            <p class="mt-1 text-base font-medium text-slate-500 dark:text-slate-400">
              AI がサポートするプロダクティビティハブ
            </p>
          </div>
        </div>

        <nav class="shell-nav" aria-label="主要ナビゲーション">
          @for (link of navigationLinks(); track link.path) {
            <a
              [routerLink]="link.path"
              routerLinkActive="shell-nav__link--active"
              [routerLinkActiveOptions]="{ exact: true }"
              class="shell-nav__link focus-ring"
            >
              {{ link.label }}
            </a>
          }
        </nav>
      </div>

      <div
        class="flex flex-col items-stretch gap-3 text-sm sm:flex-row sm:items-center sm:justify-end sm:gap-4"
      >
        <button
          type="button"
          class="shell-help-button focus-ring"
          (click)="openHelp()"
          aria-haspopup="dialog"
          [attr.aria-expanded]="isHelpDialogOpen()"
          [attr.aria-controls]="isHelpDialogOpen() ? 'help-dialog' : null"
          aria-label="Todo Generator の使い方を開く"
        >
          <svg
            aria-hidden="true"
            viewBox="0 0 24 24"
            class="h-5 w-5"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 18h.01M9.09 9a3 3 0 0 1 5.83 1.11c0 2-3 3-3 3"
            />
            <circle cx="12" cy="12" r="9" />
          </svg>
        </button>

        <button
          type="button"
          class="shell-quick-action focus-ring"
          (click)="toggleTheme()"
          [attr.aria-label]="themeToggleAriaLabel()"
        >
          <span class="shell-quick-action__icon">
            @if (themePreference() === 'system') {
              <svg
                aria-hidden="true"
                viewBox="0 0 24 24"
                class="h-5 w-5"
                fill="none"
                stroke="currentColor"
                stroke-width="1.8"
              >
                <rect x="3" y="4" width="18" height="13" rx="2" />
                <path stroke-linecap="round" d="M8 21h8m-4-4v4" />
              </svg>
            } @else if (isDark()) {
              <svg
                aria-hidden="true"
                viewBox="0 0 24 24"
                class="h-5 w-5"
                fill="none"
                stroke="currentColor"
                stroke-width="1.8"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 1 0 21 12.79Z"
                />
              </svg>
            } @else {
              <svg
                aria-hidden="true"
                viewBox="0 0 24 24"
                class="h-5 w-5"
                fill="none"
                stroke="currentColor"
                stroke-width="1.8"
              >
                <circle cx="12" cy="12" r="4" />
                <path
                  stroke-linecap="round"
                  d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364-6.364-1.414 1.414M7.05 16.95l-1.414 1.414m0-12.728 1.414 1.414m10.9 10.9 1.414 1.414"
                />
              </svg>
            }
          </span>
          <span class="shell-quick-action__label">
            {{ 'テーマ: ' + themeDisplayLabel() + '（次: ' + themeNextLabel() + '）' }}
          </span>
        </button>

        @if (isAdmin()) {
          <button
            type="button"
            class="shell-icon-action focus-ring"
            (click)="openSettings()"
            aria-label="ワークスペース設定を開く"
          >
            <span class="shell-icon-action__icon">
              <svg
                aria-hidden="true"
                viewBox="0 0 24 24"
                class="h-5 w-5"
                fill="none"
                stroke="currentColor"
                stroke-width="1.8"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m10.325 4.317 1.276-2.223a1 1 0 0 1 1.798 0l1.275 2.223a1 1 0 0 0 .748.517l2.487.362a1 1 0 0 1 .555 1.695l-1.799 1.754a1 1 0 0 0-.287.885l.425 2.472a1 1 0 0 1-1.451 1.054l-2.222-1.167a1 1 0 0 0-.934 0l-2.223 1.167a1 1 0 0 1-1.45-1.054l.424-2.472a1 1 0 0 0-.287-.885L5.83 6.891a1 1 0 0 1 .555-1.695l2.487-.362a1 1 0 0 0 .748-.517Z"
                />
                <circle cx="12" cy="12" r="2.25" />
              </svg>
            </span>
            <span class="shell-icon-action__label">設定</span>
          </button>
        }

        @if (user(); as currentUser) {
          <span class="shell-user" [attr.title]="currentUser.email">
            {{ currentUser.email }}
          </span>
          <button type="button" class="shell-primary-action focus-ring" (click)="logout()">
            <span class="shell-primary-action__icon">
              <svg
                aria-hidden="true"
                viewBox="0 0 24 24"
                class="h-5 w-5"
                fill="none"
                stroke="currentColor"
                stroke-width="1.8"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6A2.25 2.25 0 0 0 5.25 5.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15"
                />
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M18 12H9m0 0 3 3m-3-3 3-3"
                />
              </svg>
            </span>
            <span>ログアウト</span>
          </button>
        }
      </div>
    </div>
  </header>

  <main class="mx-auto flex w-full max-w-7xl flex-1 flex-col gap-8 px-6 py-10">
    <section class="flex-1">
      <router-outlet />
    </section>
  </main>

  <footer class="border-t border-subtle bg-surface-strong">
    <div
      class="mx-auto flex max-w-7xl flex-col gap-2 px-6 py-6 text-xs text-slate-500 dark:text-slate-400 sm:flex-row sm:items-center sm:justify-between"
    >
      <p>© {{ year }} Todo Generator</p>
      <p>Angular 20 Signal Architecture / ChatGPT モック統合</p>
    </div>
  </footer>

  @if (isHelpDialogOpen()) {
    <app-help-dialog (dismiss)="closeHelp()" />
  }
</div>

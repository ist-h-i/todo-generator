# 開発遵守ルール

## 1. 開発フロー
- 作業開始前・途中で最新の `main` を取り込み、差分を早めに解消する。  
- 作業は小さなコミットで積み重ね、セルフレビューで差分を点検する。  
- タスク完了前やレビュー依頼直前にも必ず最新の `main` を取り込み、コンフリクトがあれば解消する。  

---

## 2. 品質チェック

### 通常のコード修正を伴う場合
以下のチェックをすべて実行し、成功するまで繰り返す。  
- バックエンドテスト: `pytest backend/tests`  
- フロントエンドテスト: `cd frontend && npm test`  
- 静的解析: `ruff check backend`  
- コードフォーマット: `black --check backend/app backend/tests`、`cd frontend && npm run format:check`  
- ビルド: `cd frontend && npm run build`  

### コメントのみの修正 / ドキュメント修正の場合
- テスト・フォーマット・ビルドはスキップ可能。  
- ただし、影響がコードに及ぶ可能性がある場合は必ず実行すること。  

---

## 3. ドキュメント・UI
- 機能変更時は `README.md` や `docs/` 配下を最新仕様に更新する。  
- UI に変更がある場合はプレビューで確認し、スクリーンショットを取得してマージリクエストに添付する。  
- 画面バリエーションがある場合は網羅的にキャプチャを用意し、比較しやすい形で提示する。  

---

## 4. マージ前の必須事項

### 通常のコード修正を伴う場合
- マージリクエスト作成前に全チェック（テスト・フォーマット・ビルド）が成功していること。  

### コメントのみの修正 / ドキュメント修正の場合
- 全チェックの実行は不要。変更内容の妥当性確認に集中する。  

### 共通事項
- 最新の `main` を取り込み、コンフリクトがあれば解消すること。  
- コンフリクト解消後は必ず再ビルド・再テストを行うこと。  
- UI 変更がある場合はスクリーンショットを必ず掲載すること。  



{
  "development_rules": {
    "workflow": [
      "作業開始前・途中で最新の main を取り込み、差分を早めに解消する。",
      "作業は小さなコミットで積み重ね、セルフレビューで差分を点検する。",
      "タスク完了前やレビュー依頼直前にも必ず最新の main を取り込み、コンフリクトがあれば解消する。"
    ],
    "quality_checks": {
      "normal_changes": {
        "must_pass": [
          "pytest backend/tests",
          "cd frontend && npm test",
          "ruff check backend",
          "black --check backend/app backend/tests",
          "cd frontend && npm run format:check",
          "cd frontend && npm run build"
        ],
        "rules": [
          "影響範囲が限定される場合でも関連領域のチェックは必ず実行する。",
          "いずれかが失敗した状態でタスク完了やレビュー依頼を行ってはならない。",
          "チェックに失敗した場合は修正し、全てが成功するまで再実行を繰り返す。"
        ]
      },
      "doc_or_comment_changes": {
        "skip_checks": true,
        "rules": [
          "コードコメントのみの修正、またはドキュメント修正のみの場合はテスト・フォーマット・ビルドをスキップ可能。",
          "ただしコードに影響する恐れがある場合は通常チェックを実行すること。"
        ]
      }
    },
    "documentation_and_ui": [
      "機能変更時は README.md や docs/ 配下を最新仕様に更新する。",
      "UI に変更がある場合はプレビューで確認し、スクリーンショットを取得してマージリクエストに添付する。",
      "画面バリエーションがある場合は網羅的にキャプチャを用意し、比較しやすい形で提示する。"
    ],
    "pre_merge_requirements": {
      "normal_changes": [
        "マージリクエスト作成前に全チェック（テスト・フォーマット・ビルド）が成功していること。"
      ],
      "doc_or_comment_changes": [
        "コメントのみの修正やドキュメント修正の場合、チェックは不要。変更内容の妥当性確認に集中すること。"
      ],
      "common": [
        "最新の main を取り込み、コンフリクトがあれば解消すること。",
        "コンフリクト解消後は必ず再ビルド・再テストを行うこと。",
        "UI 変更がある場合はスクリーンショットを必ず掲載すること。"
      ]
    }
  }
}

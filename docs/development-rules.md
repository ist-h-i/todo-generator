# 開発時のルール

開発を円滑に進め、品質を担保するために、以下のルールを必ず遵守してください。

## 推奨開発ワークフロー

1. **最新の `main` ブランチを取り込んで作業ブランチを準備する。**
   - 作業開始前および作業途中でも適宜 `git pull origin main` を行い、差分を早めに解消してください。

2. **実装とセルフレビューを進める。**
   - 仕様書やチケットの条件を確認しながら細かなコミットを積み上げ、レビュー前に差分を読み直して問題がないか点検してください。

3. **品質チェックをまとめて実行する。**
   - ユニットテスト
     - バックエンド: `pytest backend/tests`
     - フロントエンド: `cd frontend && npm test`
   - コードフォーマットと静的解析
     - `ruff check backend`
     - `black --check backend/app backend/tests`
     - `cd frontend && npm run format:check`
   - ビルド
     - `cd frontend && npm run build`
   - 変更対象が限定される場合でも、影響が想定される領域のチェックはすべて実行してください。
   - いずれかのチェックが失敗した場合は、そのままタスクを完了させてはいけません。原因を特定して修正し、上記のチェックを**全て再実行**して成功を確認するまでこのサイクルを繰り返してください。

4. **機能の追加・変更・削除を行った場合は関連ドキュメントを最新化する。**
   - `README.md` に記載されている機能概要や利用手順が実装とずれていないか確認し、差分があれば必ず更新してください。
   - `docs/` 配下のインスコープなドキュメント（開発ルールや要件定義など）も更新対象に含めてください。
   - 各ドキュメントが最新仕様と整合するように差分を反映してください。
   - 不明点がある場合は関係者に確認し、ドキュメント間での矛盾を残さないようにしてください。

5. **UI 変更がある場合はプレビューを確認しスクリーンショットを取得する。**
   - `cd frontend && npm start` などでプレビューを立ち上げ、意図した表示になっているか確認してください。
   - 取得したスクリーンショットはマージリクエストに添付し、必要に応じて注釈を追加してください。
   - フロントエンドの HTML を変更した場合は、このスクリーンショットを画面デザインのプレビューとして最終アウトプットの作業報告 Summary に必ず掲載してください。

6. **タスク完了前に `main` ブランチと差分を突き合わせる。**
   - レビュー依頼やタスク完了報告の直前に `git fetch origin main` を実行し、`git merge origin/main`（またはチームで許可されたリベース手順）で最新の `main` を作業ブランチに取り込んでください。
   - この段階でコンフリクトが発生した場合は必ず解消し、再度ビルドとテストを実行して問題がないことを確認してください。

## マージ前の必須ルール

1. **マージリクエスト作成前にビルド・ユニットテスト・コードフォーマットのチェックがすべて成功していること。**
   - 前述のワークフローに沿って `pytest backend/tests`、`cd frontend && npm test`、`ruff check backend`、`black --check backend/app backend/tests`、`cd frontend && npm run format:check`、`cd frontend && npm run build` を実行し、エラーがないことを確認してください。
   - いずれかが失敗した状態でマージリクエストを提出しないでください。
   - 修正の過程で新たに差分が生まれた場合も、**テストとチェックを全て再実行して成功を確認するまで**マージリクエストを作成してはいけません。

2. **作業完了前およびマージリクエスト作成時点で最新の `main` を取り込むこと。**
   - `git fetch origin main` を実行したうえで、`git merge origin/main`（またはチームで定めたリベース手順）を用いてコンフリクトの有無を確認してください。
   - コンフリクトが発生した場合はその場で解消し、`git status` や `git diff --check` を利用して解消漏れがないか再確認してください。
   - 取り込み後は必要に応じて再ビルドとテストを行い、影響がないか確認してください。

3. **コンフリクトが発生した場合は必ず修正すること。**
   - コンフリクトが解消されない限りマージはできません。すべてのコンフリクトを手動で解消し、動作確認を実施してください。
   - 解消作業後は、再度ビルドとテストを実行し、問題が残っていないことを確認してください。

4. **UI デザインに変更がある場合は、全パターンのスクリーンショットを作成してマージリクエストに掲載すること。**
   - 画面サイズや状態に応じて想定される UI バリエーションがあればすべて網羅してください。
   - 新旧比較が可能な場合は並べて提示し、確認者が差分を容易に把握できるようにしてください。

これらのルールを遵守することで、マージリクエストの品質とチーム全体の開発効率を高めることができます。

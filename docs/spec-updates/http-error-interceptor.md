# HTTPエラーインターセプター要件定義

## 背景
バックエンド API 呼び出し時に HTTP ステータス 200 以外のレスポンスが返却された場合、利用者が失敗に気付きづらい課題がある。共通のエラーハンドリング箇所が存在しないため、各機能が個別に対処する必要がありメンテナンスコストが高い。

## 目的
- API 呼び出しでエラーが発生した際に、利用者へ即座に通知する。
- エラー表示ロジックを共通化し、インターセプターを通じて一元的にハンドリングする。

## 対象範囲
- フロントエンド (Angular) の HTTP クライアント通信。
- API ベース URL (`api.config.ts` の `isApiRequestUrl`) に該当する全リクエスト。

## 機能要件
1. HTTP レスポンスのステータスコードが 200 以外で失敗した場合にエラー文言を表示すること。
2. 表示するエラー文言は利用者向けの日本語メッセージとし、最低限以下を満たすこと。
   - ネットワークエラー (`status === 0`) の場合は接続失敗である旨を表示する。
   - サーバーから `detail` フィールドを伴うレスポンスがある場合は、その内容を優先して表示する。
   - 上記以外は汎用的な失敗メッセージを表示する。
3. エラー表示はアプリ共通レイアウト上に表示し、利用者が任意に閉じられること。
4. エラー表示は新しいエラーが発生した場合に更新されること。

## 非機能要件
- エラーメッセージ表示はアクセシビリティを考慮し、`role="alert"` で即時通知する。
- 既存の認証インターセプターと両立し、API 呼び出しのオーケストレーションに影響を与えないこと。

## 実装方針
- `core/api` 配下に HTTP エラーインターセプターファイルを新規作成し、`HttpInterceptorFn` で実装する。
- エラー表示用のステート管理サービスを用意し、インターセプターから通知する。
- ルートレイアウト (`Shell` コンポーネント) にエラー表示 UI を追加する。
- `app.config.ts` で新インターセプターを `provideHttpClient` に登録する。

## 除外事項
- 個別画面でのフォームバリデーションエラーなど、HTTP ステータス 200 の正常レスポンスは対象外とする。
- エラー表示の自動消滅タイマーは今回のスコープ外とする。

# 通知レイヤー再配置 要件定義

## 背景
- グローバルなサーバーエラーと、AI 提案生成などで利用する進捗・完了トーストが同じ固定位置 (画面右上) に表示されている。
- エラーと通知が同時に発生すると UI が重なり、どちらかが隠れてしまう。利用者が重要なエラーを見落とす恐れがあるほか、通知の閉じる操作がしづらい。

## 目的
- サーバーエラーを最優先で目に入る領域に配置し、気付きやすさと操作性を高める。
- 機能固有のトースト通知が視覚的に干渉しないように表示位置を整理する。
- 表示位置の整理後も既存のアクセシビリティ要件 (読み上げ優先度やフォーカス操作) を維持する。

## 対象
- `Shell` レイアウトに表示される HTTP エラー通知およびプロフィール更新トースト。
- 分析画面 (`AnalyzePageComponent`) が利用する生成中・成功・失敗トースト UI。

## 要件
1. **グローバルエラー表示**
   - 画面上部中央に横長のバナーとして固定表示する。
   - `role="alert"` を維持し、明示的な閉じるボタンを持つ。
   - バナーは他のトーストと物理的に重ならない位置に配置し、モバイル幅でも本文が折り返せること。
2. **ワークスペース共通トースト**
   - プロフィール更新など、アプリ共通のポジティブ通知は画面右下にスタック表示する。
   - スタック間隔を確保し、最大幅は 420px を上限とする。
   - `role="status"` を維持し、非モーダルで操作を妨げないこと。
3. **分析画面トースト**
   - 生成中／成功／失敗トーストは画面下部中央に表示する。
   - 横幅は 520px を上限とし、モバイルではビューポート幅に合わせて縮む。
   - 自動消滅や既存のタイマー挙動は変更しない。
4. **アニメーションと視認性**
   - 既存のフェードインアニメーションを踏襲しつつ、新しい配置に合わせて自然な動き (下部配置時は下から上への 10px 移動) に調整する。
   - バナー／トーストともに z-index を整理し、ヘッダーやダイアログよりも前面に表示する。

## 非機能要件
- 既存のテストやビルドが通ること。
- 表示位置変更に伴い、主要ブラウザー (Chromium, Firefox, WebKit 相当) で表示崩れがないこと。
- 将来トーストの種類が増えてもコンポーネント側で配置を切り替えられるよう、クラス名で役割を分離する。

## アクセシビリティ
- `aria-live` の設定は従来通り維持する (`assertive` で即時通知すべきエラー、`polite` で状況通知)。
- バナーおよびボタンはキーボード操作でフォーカス可能であること。

## 移行手順
1. Shell レイアウトのマークアップを分割し、サーバーエラーとトーストの DOM コンテナーを分離する。
2. グローバルスタイル (`styles.scss`) でバナー用クラスを新設し、既存のトーストスタイルを右下配置に調整する。
3. 分析画面スタイル (`_analyze.scss`) を更新し、トーストの固定位置を画面下部中央へ移動させる。
4. UI を実機確認し、エラーと通知が同時に発生しても重ならないことを確認する。

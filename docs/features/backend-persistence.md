# バックエンド永続化が必要な主なユーザー操作

本書では、フロントエンド単体で完結させず FastAPI バックエンドにデータを保存すべき主要操作を領域別に整理する。各操作は既存の REST ルーターとモデルでカバーされており、恒常的なデータ共有や監査証跡を確保するために永続化が前提となる。

## ボード／タスク管理
- **カードとサブタスクの CRUD**: 作成・編集・削除・ドラッグ＆ドロップによるステータス変更、完了日時の更新を `/cards` および `/cards/{card_id}/subtasks` で反映する。
- **コメントと履歴記録**: `/comments` と `/activity-log` を通じて、コメント投稿・編集・削除に伴うアクティビティ履歴を保存する。
- **手動アクティビティログの追記**: 任意イベントをタイムラインに記録するため `/activity-log` に対して追加エントリを永続化する。
- **ボードレイアウト設定の保存**: 列幅や表示設定などのレイアウト変更を `/board-layouts` 経由で `UserPreference` として保存・更新する。
- **保存済みフィルターの管理**: ボード用のクエリ条件と共有設定を `/saved-filters` で作成・更新・削除する。
- **ラベル／ステータス／エラーカテゴリ管理**: ワークスペース設定として `/labels`、`/statuses`、`/error-categories` を利用し CRUD する。

## 継続的改善・分析
- **改善イニシアチブの管理**: `/improvement-initiatives` に対して登録・更新・進捗ログの追記を行う。
- **分析スナップショットと Why-Why 分析**: `/analytics/snapshots`、`/analytics/root-causes` 等でスナップショット生成や原因ノード・提案アクションの永続化を実施する。
- **提案アクションの更新とカード変換**: `/analytics/suggestions` で状態更新し、カード化時には `/cards` へ変換結果を保存しアクティビティを記録する。

## レポート／AI ワークフロー
- **ステータスレポートの草稿・更新・送信**: `/status-reports` を通じて草稿保存、内容更新、送信、失敗時の再処理を管理する。
- **レポートテンプレートと生成済みレポート**: テンプレートおよび生成結果の CRUD をバックエンドに保持し、レポート生成処理の履歴を残す。
- **アピール生成履歴**: `/appeals` ルーターを利用し、生成リクエストとフォーマット別コンテンツ、トークン情報を永続化する。

## プロフィールとガバナンス
- **ユーザープロフィール更新**: `/profile/me` でニックネーム・経歴・ロール・自己紹介・アバター等の変更を保存する。
- **管理者による API 資格情報管理**: `/admin/api-credentials` で登録・無効化を行い、クォータのデフォルトとユーザー別上限を `/admin/quotas` で設定する。
- **ユーザー権限・個別クォータ管理**: `/admin/users` で権限やクォータの更新を反映する。

## コンピテンシー評価
- **コンピテンシー定義と評価ジョブ**: `/competencies` と `/evaluation-jobs` で定義の CRUD と対象ユーザーへの手動評価トリガーを永続化する。
- **自己評価の実行と履歴取得**: `/competency-evaluations` で評価結果を保存し、クォータ確認や消費、履歴取得を行う。

## 関連ドキュメント
- 詳細な永続化設計は [永続化処理 詳細設計](../persistence-detail-design.md) を参照。

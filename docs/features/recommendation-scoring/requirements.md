# 推薦スコア算出 要件定義書

## ドキュメント管理
| 項目 | 内容 |
| --- | --- |
| バージョン | 0.1 |
| 作成者 | プロダクトデザインチーム |
| 最終更新日 | 2024-07-09 |
| ステータス | Draft |

## 1. 目的と背景
- 生成AIが起票されたカードごとに「おすすめ度」スコアを提供し、ファシリテータが採択判断を素早く行えるようにする。
- スコアは起票内容とボードに設定されたラベルとの相関、ならびに起票ユーザの業務プロフィールとの一致度を考慮した総合値とする。
- クライアントからの任意値ではなくバックエンドでAIにより算出し、ボード全体で一貫した定義を維持する。

## 2. 利用者ペルソナ
| ペルソナ | ゴール | ニーズ |
| --- | --- | --- |
| スプリントファシリテータ | レトロスペクティブで大量に生成された提案から有効なアクションを素早く選定したい | 信頼できるおすすめ度スコアと、その背景要因が把握できるメタデータ |
| チームマネージャ | チームメンバーの職務範囲に沿ったタスクが割り当てられていることを確認したい | ユーザプロフィールを考慮したスコアリングと異常時のアラート |
| データオペレーション担当 | AI推論の安定稼働と品質を監視したい | スコア算出過程のログとメトリクス、閾値調整の自由度 |

## 3. 成功指標
| 指標 | 目標値 | 計測方法 |
| --- | --- | --- |
| スコア参照率 | 80%以上のカード確認操作でおすすめ度が閲覧される | フロントエンドのアクティビティ計測で`ai_confidence`表示イベントを集計 |
| 採択精度 | おすすめ度70以上のカードの採択率が60%以上 | 採択イベントとスコア値のクロス集計を分析基盤へ送信 |
| 推論エラー率 | スコア算出の失敗割合が1%未満 | バックエンドの推論失敗ログを監視ダッシュボードで集計 |

## 4. ユースケースと受け入れ基準
1. **AIスコアの自動付与** – カードがAI提案から生成・公開される際、自動的におすすめ度が計算され、0〜100の整数として保存される。スコアが付与されないカードは存在しないこと。
2. **ラベル相関の考慮** – ボードラベルとカード本文の相関が高いほどスコアが上昇する。ラベル情報が未設定の場合は相関サブスコアが0となる。
3. **プロフィール適合の考慮** – 起票ユーザの役割・部署・スキルがカードの想定オーナーシップと整合する場合にスコアが上昇する。不一致の場合は減点される。
4. **説明可能性の提供** – フロントエンドはスコアと併せて、主要な寄与要因（ラベル相関度、プロフィール適合度、AIモデル信頼度）を表示できるメタデータを受け取る。
5. **フォールバック動作** – AI推論が失敗した場合はおすすめ度0、および失敗要因を示すフラグがレスポンスに含まれる。

## 5. 機能要件
1. バックエンドはカード生成APIでAIスコアリングサービスを呼び出し、レスポンスに含まれる`ai_confidence`をカードエンティティへ書き込む。
2. スコアリングサービスは以下の入力を必須とする: 起票テキスト、カードに紐づくラベル一覧、起票ユーザプロフィール（役割、部署、スキルタグ）。
3. スコアリングサービスはラベル相関サブスコアとプロフィール適合サブスコアを個別に算出し、ウェイト付き合計を0〜100の整数に丸めて返す。
4. ウェイトはデフォルトで相関0.6、適合0.4とし、設定値として環境変数または管理画面から調整できる。
5. フロントエンドは`ai_confidence`を読み取り専用フィールドとして扱い、クライアント側で値を変更しない。
6. スコアの算出結果には寄与要因の詳細を含む説明文を`ai_notes`として付帯し、UIがツールチップ等で説明できるようにする。

## 6. 非機能要件
- **性能**: スコアリングはカード生成リクエストあたり300ms以下の追加レイテンシを目標とする。
- **可用性**: 推論サービスが利用不可の場合もカード生成フローは継続し、スコア0でフォールバックする。
- **監査性**: スコア計算に使用した入力と算出結果を14日間保持し、監査問い合わせに応じられるようにする。
- **セキュリティ**: プロフィール情報は最小限（役割、部署、スキルタグ、社歴など）に限定し、機密情報を含めない。

## 7. 依存関係と制約
- OpenAI APIまたは社内LLMエンドポイントへのネットワークアクセスが必須。
- ボードラベルとユーザプロフィールの整備度合いがスコア精度に影響するため、マスター同期が前提。
- 将来的なフィードバックループ（採択実績からの重み調整）を見越し、データポイントを分析基盤へ連携する。
